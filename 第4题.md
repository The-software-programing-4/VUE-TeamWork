semaphore mutex1=1,mutex2=1

//mutex1 互斥读取

//mutex2 

//empty 余票是否为空

int cnt = N ; //余票的数量

main()

cobegin{

//Q 操作

while(true)

{

   p(mutex1);

   read();

  v(mutex1); 

}

//B操作

while(true)

{

  p(mutex1);

  if(cnt<=0 )

   { v(mutex1); continue; }

   cnt -- ; //购票

  v(mutex1);     

}

}coend



```
int count = 0; //íP£HöÿÏgñċ.
semaphore mutex = 1; //òvcountXĈÂ%ñċ
semaphore w = 1; //t¾“0=”
writer (){
while(1){
P(w);
P(rw);

…
V(rw);
V(w);
} }
reader (){
while(1){
P(w);
P(mutex);
if(count==0)
P(rw);
count++;
V(mutex);
V(w);
ö.…
P(mutex);
count--;
if(count==0)
V(rw);
V(mutex);
} }
```

```
//读是不写 只有读完才能写

semaphore num=N;//余票数量

int count=0;//记录当前有几个Q访问

semaphore mutex=1;//对count的互斥访问

semaphore w_N=1;//买票锁

Q(){

P(mutex);

if(count==0) 

P(w_N);//锁num，不能买，防止读时，写改变了数

count++;

V(mutex);//解锁count

读余票

P(mutex);

count--；

if(count==0) 

V(w_N);//释放num，可以买

V(mutex);//解锁count

}

B(){

P(w_N);//先检查可不可写

P(N);//买票

V(w_N);

}


```

